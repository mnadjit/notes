---
aliases:
  - Information Gathering
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - information_gathering
author: Mehdi N Tehrani
creat_date: 2023-12-22
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Active Information Gathering
https://lolbas-project.github.io/

# DNS
#dns
## host 
#host
- `host <domain_name>`
- `host -t <record_type> <domain_name>`
	- `host -t mx www.megacorpone.com`

- *NS*: Nameserver records contain the name of the authoritative servers hosting the DNS records for a domain.
- *A*: Also known as a host record, the "a record" contains the IPv4 address of a hostname (such as www.megacorpone.com).
- *AAAA*: Also known as a quad A host record, the "aaaa record" contains the IPv6 address of a hostname (such as www.megacorpone.com).
- *MX*: Mail Exchange records contain the names of the servers responsible for handling email for the domain. A domain can contain multiple MX records.
- *PTR*: Pointer Records are used in *reverse lookup* zones and can find the records associated with an IP address.
- *CNAME*: Canonical Name Records are used to create aliases for other host records.
- *TXT*: Text records can contain any arbitrary data and be used for various purposes, such as domain ownership verification.

- `NXDOMAIN` when the domain is not found #nxdomain
```sh
$ host no.megacorpone.com
Host no.megacorpone.com not found: 3(NXDOMAIN)
```

### Brute-force DNS names
#brute_force 
```sh
$ for sub in $(cat dns_wordlist.txt); do host $sub.megacorpone.com; done
www.megacorpone.com has address 149.56.244.87
Host ftp.megacorpone.com not found: 3(NXDOMAIN)
Host smtp.megacorpone.com not found: 3(NXDOMAIN)
mail.megacorpone.com has address 51.222.169.212
Host owa.megacorpone.com not found: 3(NXDOMAIN)
Host proxy.megacorpone.com not found: 3(NXDOMAIN)
router.megacorpone.com has address 51.222.169.214
```
#### optimized: remove unavailable records
#grep
`for sub in $(cat dns_wordlist.txt); do host $sub.megacorpone.com; done | grep -iv nxdomain`

#### Reverse DNS Lookup
```
for i in $(seq 200 254); do host 51.222.169.$i; done | grep -iv "not found"
```

## dnsrecon
#dnsrecon 
Syntax
- `dnsrecon -d <domain_name> -t <type>`
	- `dnsrecon -d megacorpone.com -t std`
	- std=standard
- `$ dnsrecon -d megacorpone.com -D ./subdomain_wordlist.txt -t brt`

## dnsenum
#dnsenum
Syntax:
`dnsenum <domain_name>`

## nslookup
`nslookup <domain_name>`
`nslookup <domain_name> -type=ns`
`nslookup <domain_name> -type=txt`


# TCP/UDP Port Scanning Theory
[Linux IPv4 raw sockets](https://man7.org/linux/man-pages/man7/raw.7.html)
## netcat
 #netcat #nc
Syntax
```
nc -nvv -w 1 -z <ip> <port_range>
    ^ no dns
     ^ verbose 
         ^ timeout 1sec
              ^ zero; empty packet
```

## Nmap
#nmap 
[nmap target specification](https://nmap.org/book/man-target-specification.html)
### monitor namp using iptables
#iptables #monitor_packet_count
use it to monitor the amount of traffic transferred with each nmap scan
- set up iptables:
	- `sudo iptables -I INPUT 1 -s <ip> -j ACCEPT`
	- `sudo iptables -I OUTPUT 1 -d <ip> -j ACCEPT`
	- `sudo iptables -Z`: zero the packet counter
	- `nmap <ip>`
	- `sudo iptables -vn -L`

> [!info] a full Nmap scan of a class C network (254 hosts) would result in sending over 1000 MB of traffic to the network.

- similar to nmap but less stealthy:
	- MASSCAN
	- RustSCAN

### Scan types
#### SYN
`sudo nmap -sS`
#### TCP
`nmap -sT`
#### UDP
`sudo nmap -sU`
- nmap sends an empty UDP message to the desination and if the destination UDP port is closed, an `ICMP port unreachable` empty message will be received back. If no responses return, the port maybe open or the packet might have been filtered by a firewall or router. 
- As for common UDP port like 161 (SNMP), nmap sends a protocol-specific message to the destination to get a response back.
#### Network Sweep
#network_sweep
[nmap host discovery](https://nmap.org/book/man-host-discovery.html)

`nmap -sn <ip_range>`
`nmap -v -sn <ip_range> -oG ping_sweep.txt`: no port scan
`nmap -p  80 <ip_range> -oG web_sweep.txt` 

`nmap <ip_range> -Pn` : don't ping the host; just scan it
`nmap <ip_range> -PA` : TCP ACK ping; nmap sends ACK and the host responds with RST

#### top-ports
#top_ports
`nmap --top-ports=20 <ip_range>`
`/user/share/nmap/nmap-services`: contains list of ports and their popularity
#### OS Fingerprinting
`--osscan-guess`: user to force nmap to guess when OS fingerprinting is not fully accurate

#### nmap scripts
- NSE: *Nmap Scripting Engine*
We can use the NSE to launch user-created scripts in order to automate various scanning tasks. These scripts perform a broad range of functions including *DNS enumeration*, *brute force attacks*, and even *vulnerability identification*. NSE scripts are located in the `/usr/share/nmap/scripts` directory.

- `-Sv`: run a plain service nmap scan
- `-A`: run service scan with extra options
- `--script <script_name>`: run a specific script only

- Get more info about a certain script
`nmap --script-help <script_name>`
`nmap --script-help http-headers`

- Check with PowerShell if a port is open on a remote host
#lol_technique #living_off_the_land #powershell
```powershell
Test-NetConnection -Port <port> <ip>
```

- Batch scan of ports
#powershell #port_scan
```powershell
1..1024 | % { echo ((New-Object Net.Sockets.TcpClient).Connect("192.168.1.10", $_)) "TCP port $_ is open." } 2>$null
```


# SMB
#smb #netbios #nbt #netbios_over_tcp
The NetBIOS service listens on TCP port 139, as well as several UDP ports. It should be noted that SMB (TCP port 445) and NetBIOS are two separate protocols. NetBIOS is an independent session layer protocol and service that allows computers on a local network to communicate with each other. While modern implementations of SMB can work without NetBIOS, *NetBIOS over TCP* (*NBT*) is required for backward compatibility and these are often enabled together.
The SMB discovery script works only if SMBv1 is enabled on the target, which is not the default case on modern versions of Windows. 
## nmap
`nmap -p 139,445 <ip_range>`

## nbtscan
`sudo nbtscan -r <cidr>`

## net
#windows #net_view
`net view \\<host> /all`
`/all` shows `ADMIN$` and `IPC$` as well

## enum4linux
#enum4linux
Details about OS info, SMB shares, users, groups, password policy,  etc.
`enum4linux <ip>`
# SMTP
#smtp #mail #vrfy #expn
A **VRFY** request asks the server to verify an email address, while **EXPN** asks the server for the membership of a mailing list.
```
nc -nv <ip> 25
220 mail ESMTP Postfix (Ubuntu)

VRFY root
252 2.0.0 root

VRFY someone
550 5.1.1 <someone>: Recipient address rejected: User unknown in local recipient table

```

#windows #powershell #telnet #dism
On Windows powershell *Test-NetConnection* command or *telnet client* can be used to examine smtp port on a remote host. 
```powershell
Test-NetConnection $ip 25
```
It can be installed using `dism`:
- `dism /online /Enbale-Feature /FeatureName:TelnetClient`
telnet: `telnet <ip> 25`

# SNMP
#snmp #aes_256 #des_56
The commonly used SNMP protocols *1*, *2*, and *2c* offer no traffic encryption, meaning that SNMP information and credentials can be easily intercepted over a local network. *SNMPv3* used to support only *DES-56* (weak encryption susceptible to brute-force attacks. A more recent SNMPv3 implementation supports the *AES-256* encryption scheme.

## SNMP MIB Tree
#mib #management_information_base
https://www.ibm.com/docs/en/aix/7.1?topic=management-information-base
Management Information Base (MIB): a database containing information usually related to network management
### Community String
#community
An identifier for an MIB tree
Most common ones:
- `public`
- `private`
- `manager` 
### OID
#oid 
https://en.wikipedia.org/wiki/Object_identifier
a specific branch of MIB. **snmpwalk** can query this.
### Tools
#### nmap
```sh
$ sudo nmap -sU --open -p 161 <ip>
```

#### onesixtyone
#onesixtyone
http://www.phreedom.org/software/onesixtyone/
```sh
$ onesixtyone -i ips.txt [-c community.txt]
```

#### snmpwalk
#snmpwalk 
```sh
$ snmpwalk -c public -v 2c -t 10 -Oa <ip> [<oid>]
          ^ community
                    ^ version
                          ^ timeout seconds
                                  ^ output to ascii
```
examples:
```sh
$ snmpwalk -c public -v 2c -t 10 <ip> '1.3.6.1.4.1.77.1.2.25'    # all local user accounts
$ snmpwalk -c public -v 2c -t 10 <ip> '1.3.6.1.2.1.25.4.2.1.2'   # all running processes
$ snmpwalk -c public -v 2c -t 10 <ip> '1.3.6.1.2.1.25.6.3.1.2'   # all installed apps
$ snmpwalk -c public -v 2c -t 10 <ip> '1.3.6.1.2.1.6.13.1.3'     # all tcp listening ports
```


