---
aliases:
  - Unquoted Service Paths
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - windows
  - privesc
  - privilege_escalation
  - service
  - windows_services
  - dll
  - unquoted
  - unquoted_service_path
author: Mehdi N Tehrani
creat_date: 2024-01-02
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Logic
Each Windows service maps to an executable file that will be run when the service is started. When a service is started and a process is created, the Windows _CreateProcess_ function is used. Reviewing the first parameter of the function, _lpApplicationName_ is used to specify the name and optionally the path to the executable file.

If the provided string **contains spaces** and is **not enclosed within quotation marks**, it can be interpreted in various ways because it is unclear to the function where the file name ends and the arguments begin. To determine this, the function starts interpreting the path from left to right until a space is reached. For every space in the file path, the function uses the preceding part as file name by adding **.exe** and the rest as arguments.

Example:
for a service path such as `C:\Program Files\My Program\My service\service.exe` if unquoted, the following paths will be searched:
```
C:\Program.exe
C:\Program Files\My.exe
C:\Program Files\My Program\My.exe
C:\Program Files\My Program\My service\service.exe
```


# Process
## Find services with spaces and unquoted paths
```powershell
wmic service get name,pathname | select-string -NotMatch "C:\\Windows\\" | select-string -NotMatch "`"" | ? {$_ -match '\w+'}
```
or 
```cmd
wmic service get name,pathname | findstr /i /v "C:\\Windows\\" | findstr /i /v """
```

## Check permissions
for each path:
```
icacls 'C:\Program Files'
icacls 'C:\Program Files\My Program'
icacls 'C:\Program Files\My Program\My Service'
```

if current user or `BuiltIn\Users` have write permission to for example `C:\Program Files\My Program`, the exploit can be placed in this path: `C:\Program Files\My.exe`

