---
aliases:
  - Windows Security Overview
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - windows
  - privesc
  - privilege_escalation
author: Mehdi N Tehrani
creat_date: 2024-01-01
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Windows Privileges
## SID (Security Identifier)
#sid #security_identifier
An [SID](https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers) is a unique value assigned to each entity, or principal, that can be authenticated by Windows, such as users and groups. 
- The SID for *local accounts* and groups is generated by the *Local Security Authority* ([LSA](https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/configuring-additional-lsa-protection))
- for *domain* users and groups, it's generated on a *Domain Controller* (DC) 
The SID cannot be changed and is generated when the user or group is created.
### Format
```
S-R-X-Y
^ SID
  ^ Revision; always '1'
    ^ identifier authority; most common '5' (NT Authority) for both local and domain principals
      ^ sub authorities of the identifier authority 
```
Example:
```
S-1-5-21-1336799502-1441772794-948155058-1001
```
### Y part
Every SID consists of one or more sub authorities. This part consists of the **domain identifier** and **relative identifier (RID)**. 

The **domain identifier** is:
- SID of the *domain*: for *domain users*
- SID of the *local machine*: for *local* users
- *32*: for *built-in principals*. 

The **RID** determines principals such as users or groups. Starts at 1000 for non-built-in principals.

### Well-known SIDs
#well_known_sids #sid #well_known 
RIDs under 1000
```
S-1-0-0                       Nobody        
S-1-1-0	                      Everybody
S-1-5-11                      Authenticated Users
S-1-5-18                      Local System
S-1-5-domainidentifier-500    Administrator
```


## Access Tokens
#access_tokens #access_token
[Access Tokens](https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens)
token contains various pieces of information that effectively describe the **security context** of a given user.
### Security Context
#security_context #token_security_context
- SID of the user
- SIDs of the groups the user is a member of
- the user and group privileges
- further information describing the scope of the token.
### Windows Authentication Process
#authentication_process #windows
Once a user is authenticated, Windows generates an access token that is assigned to that user. 

#primary_token
When a user starts a process or thread, a token (**primary token**) will be assigned to them. 
**primary token** specifies which permissions the process or threads have when interacting with another object
**primary token** is a copy of the access token of the user.

#impersonation_token
Impersonation tokens are used to provide a different security context than the process that owns the thread

## Manatory Integrity Control
#mandatory_integrity_control
[Manatory Integrity Control](https://docs.microsoft.com/en-us/windows/win32/secauthz/mandatory-integrity-control) uses *integrity levels* to *control access to securable objects*. We can think of these levels as *hierarchies of trust* Windows has in a running application or securable object. 

When processes are started or objects are created, they receive the integrity level of the principal performing this operation. An exception is if an executable file has a low integrity level, the process's integrity level will also be low.

A principal with a lower integrity level cannot write to an object with a higher level, even if the permissions would normally allow them to do so.

### Integrity levels
- **System**: SYSTEM (kernel, ...)
- **High**: Elevated users
- **Medium**: Standard users
- **Low**: Very restricted rights often used in sandboxed `[^privesc_win_sandbox]` processes or for directories storing temporary data
- **Untrusted**: Lowest integrity level with extremely limited access rights for processes or objects that pose the most potential risk

### Commands
[icalcs](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/icacls)
```
whoami /groups
icalcs
```

## User Account Control
#uac #user_account_control 
[UAC](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-control-overview)
[How UAC works](https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works)
protects the operating system by running most applications and tasks with standard user privileges, even if the user launching them is an Administrator.  For this, an administrative user obtains two access tokens after a successful logon. 
- The first token is a standard user token (or filtered admin token), which is used to perform all non-privileged operations.
- The second token is a regular administrator token. It will be used when the user wants to perform a privileged operation.
