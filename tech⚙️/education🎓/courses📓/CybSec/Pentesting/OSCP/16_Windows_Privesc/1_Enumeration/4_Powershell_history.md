---
aliases:
  - Powershell history
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - windows
  - privesc
  - privilege_escalation
  - enumeration
  - enum
  - powershell
  - powershell_history
author: Mehdi N Tehrani
creat_date: 2024-01-01
category: Cyber Security
subcategory: Offensive Security - OSCP
---

[Powershell Transcription](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.host/start-transcript)
#transcription
a.k.a. over-the-shoulder-transcription
The information is stored in transcript files, which are often saved in the home directories of users, a central directory for all users of a machine, or a network share collecting the files from all configured machines.


[Powershell Script Block Logging](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_logging_windows?view=powershell-7.2)
#script_block_logging
Script Block Logging records commands and blocks of script code as events while executing. This results in a much broader logging of information because it records the full content of code and commands as they are executed. This means such an event also contains the original representation of encoded code or commands.

#clear_history
`Clear-History` only clears PowerShell's own history, which can be retrieved with `Get-History`.
`Clear-History` does not clear the command history recorded by `PSReadline`. 

[PSReadLine](https://docs.microsoft.com/en-us/powershell/module/psreadline/?view=powershell-7.2)
#psreadline #get_psreadlineoption
a module named `PSReadline` is included, which is used for line-editing and command history functionality. 
- Command:
```powershell
gc (Get-PSReadlineOption).HistorySavePath
```

# evil-winrm
#evil_winrm 
[Evil-WinRM GitHub](https://github.com/Hackplayers/evil-winrm)
Functionalities:
- pass the hash
- in-memory loading
- file upload/download

Usage:
```sh
evil-winrm -i <ip> -u <user> -p <password>
```


# Mitigation
```powershell
Set-PSReadlineOption -HistorySaveStyle SaveNothing
```

# Monitoring
```powershell
get-winevent -MaxEvents 10 -FilterHashtable @{ 
	Logname='Microsoft-Windows-Powershell/Operational'
	ProviderName='Microsoft-Windows-PowerShell'
	Id=4104 
}

get-winevent | ? { $_.id -eq 4104 }
```