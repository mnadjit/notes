---
aliases:
  - Active Directory Enumeration - Object Permissions
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - active_directory
  - ad
  - adds
  - enum
  - enumeration
  - object_permissions
author: Mehdi N Tehrani
creat_date: 2024-01-06
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Overview
#ace #acl #access_control_entry #access_control_list 

Permissions applied to objects in AD are defined by:
*ACE*: [Access Control Entry](https://learn.microsoft.com/en-us/windows/win32/secauthz/access-control-entries)
*ACL*: [Access Control List](https://learn.microsoft.com/en-us/windows/win32/secauthz/access-control-lists)
[Active Directory Rights - Permission Types](https://learn.microsoft.com/en-us/dotnet/api/system.directoryservices.activedirectoryrights?view=netframework-4.7.2)
[List of Permissions - Access Rights & Access Masks](https://learn.microsoft.com/en-us/windows/win32/secauthz/access-rights-and-access-masks)

# Access Validation
ACL validation involves two main steps.
1. the user sends an **access token**, which consists of the *user identity* and *permissions*.
2. The target object will then validate the token against the list of permissions (the ACL)

# Key Permission Types
- `GenericAll`: Full permissions on object
- `GenericWrite`: Edit certain attributes on the object
- `WriteOwner`: Change ownership of the object
- `WriteDACL`: Edit ACE's applied to object
- `AllExtendedRights`: Change password, reset password, etc.
- `ForceChangePassword`: Password change for object
- `Self (Self-Membership)`: Add ourselves to for example a group

# PowerView
#powerview 
## Get-ObjectAcl
#get_object_acl
all ACE's that grant or deny a permission to a user:
```powershell
Get-ObjectAcl -Identity $username
```

Key output:
#object_sid #activedirectory_rights #security_identifier #objectsid #ad_rights #securityidentifer
```
[...]
ObjectSID              : S-1-5-21-1987370270-658905905-1781884369-1104
ActiveDirectoryRights  : ReadProperty
[...]
SecurityIdentifier     : S-1-5-21-1987370270-658905905-1781884369-553
[...]
```
This output means the object with value in `SecurityIdentifier` has `Read` access to object with SID value in `ObjectSID`

```powershell
Get-ObjectAcl -Identity "Management Department" | ? {$_.ActiveDirectoryRights -contains @('GenericAll') } | select @{n='obj';e={Convert-SidToName $_.SecurityIdentifier}}, activedirectoryrights
```

```powershell
Get-ObjectAcl | ?{@('genericall','genericwrite','writeowner','writedacl','allextendedrights','forcechangepassword','self') -contains $_.activedirectoryrights -and $_.securityidentifier -eq 'S-1-5-21-1987370270-658905905-1781884369-20601'} | select @{n='obj';e={Convert-SidToName $_.SecurityIdentifier}}
```
## Convert-SidToName
#convert_sid_to_name
```powershell
PS > Convert-SidToName S-1-5-21-1987370270-658905905-1781884369-1104
CORP\stephanie
```


# Group Enumeration and update
#group #adgroup #enumeration #add_user #add_user_to_group #remove_user #delete_user #del_user_from_group

## Add user to group
#cmd #net #net_group
```cmd
net group %group_name% %username% /domain /add 
```
## Delete user from group
#cmd #net #net_group
```cmd
net group %group_name% %usernam% /domain /del
```
## Get group members 
#powerview
```powershell
Get-NetGroup $groupname | select member
```

