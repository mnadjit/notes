---
aliases:
  - AD Service Principal Names
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - active_directory
  - ad
  - adds
  - enum
  - enumeration
  - spn
  - service_principal_name
author: Mehdi N Tehrani
creat_date: 2024-01-06
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Windows Builtin System Accounts
[Windows Service Accounts](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/service-accounts-on-premises)
- [LocalSystem](https://learn.microsoft.com/en-us/windows/win32/services/localsystem-account)
- [LocalService](https://learn.microsoft.com/en-us/windows/win32/services/localservice-account)
- [NetworkService](https://learn.microsoft.com/en-us/windows/win32/services/networkservice-account)

For more complex applications, a *domain user account* may be used to provide the needed context while still maintaining access to resources inside the domain.

# Managed Service Accounts
#managed_service_account
When applications like Exchange, MS SQL, or Internet Information Services (IIS) are integrated into AD, *a unique service instance identifier* known as *Service Principal Name* ([SPN](https://learn.microsoft.com/en-us/windows/win32/ad/service-principal-names)) associates a service to a specific service account in Active Directory.

introduced with *Windows Server 2008 R2*, were designed for *complex applications, which require tighter integration with Active Directory*.

## Group Managed Service Accounts
[Group Managed Service Account - Microsoft Article](https://learn.microsoft.com/en-us/windows-server/security/group-managed-service-accounts/group-managed-service-accounts-overview)

- Larger applications like MS SQL and Microsoft Exchange often required *server redundancy* when running to guarantee availability, but *Managed Service Accounts did not support this*. 
- To remedy this, **Group Managed Service Accounts** were introduced with *Windows Server 2012*. 
	- This requires that domain controllers run Windows Server 2012 or higher. Because of this, some organizations may still rely on basic Service Accounts.


> [!important] **IP address and port number** of applications running on servers integrated with AD can be obtained by **enumerating all SPNs** in the domain


## Enumeration Tools
#information_gathering #scanning
### setspn
#setspn
windows builtin tool

```cmd
> setspn -L <service_name>
        ^ target both clients and servers

> setspn -L iis_service
Registered ServicePrincipalNames for CN=iis_service,CN=Users,DC=corp,DC=com:
        HTTP/web04.corp.com
        HTTP/web04
        HTTP/web04.corp.com:80
```

### PowerView
#powerview 
```powershell
Get-NetUser -SPN | select samaccountname,serviceprincipalname
```

