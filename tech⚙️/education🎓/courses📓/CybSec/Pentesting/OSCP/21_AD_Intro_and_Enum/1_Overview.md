---
aliases:
  - Active Directory Enumeration
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - active_directory
  - ad
  - adds
  - overview
author: Mehdi N Tehrani
creat_date: 2024-01-05
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# Overview
[Microsoft Article](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview)


AD relies on several components and communication services. For example, when a user attempts to log in to the domain, a request is sent to a Domain Controller (DC), which checks whether or not the user is allowed to log in to the domain. One or more DCs act as the hub and core of the domain, storing all OUs, objects, and their attributes. 

Members of **Domain Admins** are among the most privileged objects in the domain.

An AD instance can host more than one domain in *a domain tree* or *multiple domain trees* in a domain forest. Members of the **Enterprise Admins** group are granted full control over all the domains in the forest and have Administrator privilege on all DCs.

# General Approach
- Check if user is admin: run powershell as admin
```
whoami /priv
```
- Load PowerView
```
. ./PowerView.ps1
```
- Get Domain
```
$domain = Get-NetDomain
$dname = $domain.name.split('.')[0]
```
- Get all users
```
$users = Get-NetUser
$users | select cn,memberof

$spn = Get-NetUser -SPN
$spn_info = $spn | select cn,serviceprincipalname
```
- Get all groups
```
$groups = Get-NetGroup
$groups | select cn,member,memberof | fl
```
- Get all computers
```
$comps = Get-NetComputer
```
- Get all domain shares
```
Find-DomainShare
Find-DomainShare -CheckShareAccess
```
- Get all ACLs
```
$acls = Get-ObjectAcl
```
- Find where current user is local admin
```
$locad = Find-LocalAdminAccess
```
- Find on each computer who is logged in
```
$psloggedonPath = ''

$pslogdon = ($comps | select cn | % { echo $_; echo "$(iex "$psloggedonPath \\$($_.cn)" | select-string $dname)"; echo '' })
```