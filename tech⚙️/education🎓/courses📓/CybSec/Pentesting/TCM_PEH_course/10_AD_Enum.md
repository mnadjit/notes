---
aliases:
  - Active Directory Enumeration (Post Compromise)
tags:
  - tech
  - cybsec
  - certification
  - oscp
  - active_directory
  - enumeration
author: Mehdi N Tehrani
creat_date: 2023-12-09
category: Cyber Security
subcategory: Offensive Security - OSCP
---

# ldapdomaindump
#ldapdomaindump
> only ldapdomaindump in `/usr/bin/` worked but not those found in user path

Command:
```
mkdir <domain> && cd <domain>
sudo ldapdomaindump ldaps://<dc_server> -u '<domain>\<user>' -p '<password>'
```

Result:
```
[*] Connecting to host...
[*] Binding to host
[+] Bind OK
[*] Starting domain dump
[+] Domain dump finished
```
Files created:
```
domain_computers_by_os.html
domain_computers.json
domain_groups.json
domain_policy.json
domain_trusts.json
domain_users.html
domain_computers.grep
domain_groups.grep
domain_policy.grep
domain_trusts.grep
domain_users_by_group.html
domain_users.json
domain_computers.html
domain_groups.html
domain_policy.html
domain_trusts.html
domain_users.grep
```
# Bloodhound
#bloodhound
`sudo pip install bloodhound`

## neo4j
#neo4j
`sudo neo4j console`
Output
```
...
Bolt enabled on localhost:7687      --> this is what bloodhound will bind to
Remote interface available at localhost:7474
...
```
Access via localhost:7474
default login: `neo4j/neo4j`

Generate files needed for bloodhound:
`sudo bloodhound-python -d <domain> -u <user> -p <password> -ns <name_server_ip> -c all`

> command above didn't work, but the following did:
`sudo ~/.local/pipx/venvs/crackmapexec/bin/python $(which bloodhound-python) -d <domain> -u <user> -p <password> -ns <name_server_ip> -c all`

Launch bloodhound and 'Upload Data':
`sudo bloodhound`



# Plumhound
#plumhound
Git clone from github repo:
`cd /opt`
`sudo git clone https://github.com/PlumHound/PlumHound.git`
`sudo pip3 install -r requirements.txt`
Plumhound works in conjunction with bloodhound. Make sure bloodhound is running.
Test if Plumhound is able to work fine:
`sudo python3 PlumHound.py --easy -p <password>`
Run Plumhound:
`sudo python3 PlumHound.py -x tasks/default.tasks -p <password>`
Reports get dumped into `reports` directory
`cd reports` 
`firefox index.html`

## LAPS
One of the features found in the report that can be used or not used by an organization is LAPS.
#laps #windows_laps
[Windows LAPS](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview)
Windows Local Administrator Password Solution (Windows LAPS) is a Windows feature that automatically manages and backs up the password of a local administrator account on your Azure Active Directory-joined or Windows Server Active Directory-joined devices. You also can use Windows LAPS to automatically manage and back up the *Directory Services Restore Mode (DSRM)* account password on your Windows Server Active Directory domain controllers. An authorized administrator can retrieve the DSRM password and use it.
Benefits:
- Protection against *pass-the-hash* and *lateral-traversal attacks*
- Improved security for remote help desk scenarios
- Ability to sign in to and recover devices that are otherwise inaccessible
- A fine-grained security model (access control lists and optional password encryption) for securing passwords that are stored in Windows Server Active Directory
- Support for the Entra role-based access control model for securing passwords that are stored in Entra ID


# PingCastle
#pingcastle
A useful domain audit tool
Can run locally or remotely
A windows executable
produces an html file with the report and defines risks and how to mitigate them
